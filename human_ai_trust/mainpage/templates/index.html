{% extends "template.html" %}

{% block content %}
  <div class="container-fluid" style="height: 100vh; padding-top: 1vh">
    <div class="row">
      <div class="col-10 offset-1" style="border: thin solid grey; border-radius: 10px;">

        <!-- HEADING -->
        <div class="row d-flex justify-content-center" style="height: 10vh; padding: 0; background: lightskyblue; border-radius: 10px;">
          <div class="align-self-center">
            <h1>Human-AI Team Diagnosis</h1>
          </div>
        </div>

        <!-- CONTENT -->
        <div class="row" style="height: 70vh; background: #c7e6f7; padding: 0; border-radius: 10px;">

          <!-- LEFT -->
          <div class="col-7">
            <div class="row" style="background: ghostwhite;">
              <div id="stateCarousel" class="carousel slide" data-ride="carousel" style="width: 100%">
                <div class="carousel-inner">

                  <!-- Directions -->
                  <div class="carousel-item">
                    <div class="col">
                      <div class="row" style="height: 70vh; background: rgba(120,180,255,0.2); padding: 1vh">

                        <h2>Directions</h2>
                        <h2>Directions</h2>
                        <p> 
                        <b>Objective</b>: You will see a series of 50 patients and the objective is to diagnose them with a mysterious new flu-like illness called NOVID-20 as either (1) positive or (2) negative.<br>

                        <b>Info</b>: For each patient, you will see information about their health, including presence of cough and chills, body temperature, blood pressure, and weight. Note: no prior knowledge of medicine is needed nor expected for these tasks. <br>

                        <b>AI</b>: You will have the help of an AI tool that predicts whether each patient is positive or negative for NOVID-20. You can either choose to go with the AIâ€™s prediction or manually override and select the other diagnosis. <br>

                        <b>Updating the AI</b>: The AI isn't always correct in diagnosing patients. When you disagree with the AI prediction, you can help the AI learn from its mistakes by clicking the update button. <i>Be warned, updating the AI when you are incorrect (and the model is correct) will lead to a decrease in its performance for future rounds</i><br>

                        <b>Points</b>: Everytime you diagnose a patient, you will be told whether your decision was right or wrong and how many points you gained. <i>Your objective is to maximize the number of points you have at the end</i>. For every correct diagnosis, you <i> gain 2 points</i> and for every incorrect diagnosis, you <i>lose 4 points</i>.
                        </p>
                      </div>
                    </div>
                  </div>

                  <!-- Task -->
                  <div class="carousel-item active">
                    <div class="col">
                      <div class="row" style="height: 70vh; background: #c7e6f7; padding: 1vh;">
                        <div id="task" style="height: 100%; width:100%; background: #c7e6f7;">
                          <h2>Patient Profile</h2>
                          <ul>
                            {% for key, value in feature_display_dict.items %}
                              <li><b>{{key}}</b>: {{value}}</li>
                            {% endfor %}
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- RIGHT -->
          <div class="col-5">
            <div class="row" style="height: 15%; background: #c7e6f7; padding-left: 2vh; padding-bottom: 1vh; padding-right: 1vh; padding-top: 1vh">
                  <!-- Default checked -->
                  <div class="custom-control custom-switch">
                    <input type="checkbox" class="custom-control-input" id="customSwitch1"  checked>
                    <label class="custom-control-label" for="customSwitch1"  onclick="switchView()">View directions</label>
                  </div>
            </div>
            <div class="row justify-content-center" style="height: 85%; width: 100%; background: #c7e6f7; padding-left: 1vh; padding-bottom: 2vh; padding-right: 1vh; padding-top: 0vh">
              <div class="col-12" style="width: 100%;">
                <!-- Diagnose-->
                <div class = "row justify-content-center" style="height: 50%; width: 100%;">
                  <div id="buttonDiv" class = "align-self-center" style="width:100%;">
                    AI's recommendation: <span id="ai-prediction" style="color: blue;">{{ ml_model_prediction }}</span>
                    <br>
                    AI's confidence: <span id="ai-prediction" style="color: blue;">{{ ml_confidence }}</span>
                    <br>
                    <br>
                    Your diagnosis: <br>
                     <!-- <form method="POST">
                        {% csrf_token %} -->
                      <button type="submit" class="btn btn-success" data-toggle="modal" data-target="#agreeModal">Positive</button>
                      <button type="submit" class="btn btn-danger" data-toggle="modal" data-target="#disagreeModal">Negative</button>
                    <!-- </form> -->
                    <!-- Button for update -->

                    <!-- Modal when they agree -->
                    <div class="modal fade" id="agreeModal" tabindex="-1" role="dialog" aria-labelledby="agreeModalLabel" aria-hidden="true">
                      <div class="modal-dialog" role="document">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="agreeModalLabel">Trust in AI</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                            </button>
                          </div>
                          <form>
                            <div class="modal-body">
                              <ol>
                                <li> How much do you trust the model?
                                <div class="form-check">
                                  <input type="checkbox" class="form-check-input" id="exampleCheck1">
                                  <label class="form-check-label" for="exampleCheck1">Check me out</label>
                                </div>
                              </ol>
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                              <button type="button" class="btn btn-primary">Next patient</button>
                            </div>
                          </form>
                        </div>
                      </div>
                    </div>

                    <!-- Modal when they disagree -->
                    <div class="modal fade" id="disagreeModal" tabindex="-1" role="dialog" aria-labelledby="disagreeModalLabel" aria-hidden="true">
                      <div class="modal-dialog" role="document">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="disagreeModalLabel">Modal title</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                            </button>
                          </div>
                          <div class="modal-body">
                            <ol>
                                <li> How much do you trust the model?
                                <div class="form-check">
                                  <input type="checkbox" class="form-check-input" id="exampleCheck1">
                                  <label class="form-check-label" for="exampleCheck1">Check me out</label>
                                </div>                               

                                <li> Why did you disagree with the model?
                                  <div class="form-check">
                                    {% for option in user_response.USER_RESPONSES %}
                                      <input class="form-check-input" type="radio" name="radio" id="{{option.0}}" value={{option.0}} checked>
                                      <label class="form-check-label" for="{{option.0}}">
                                        {{option.1}}
                                      </label> 
                                    {% endfor %}
                                  </div>

                                  <li> Explanation for disagreement
                              </ol>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Don't Update</button>
                            <button type="button" class="btn btn-primary">Update Model</button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- Score -->
                <div class = "row justify-content-center" style="height: 50%;">
                  <div id="scoreDiv" class = "align-self-center" style="height:100%; width:100%">
                    <h3> Your current score: <span id="score">20</span> pts</h3>
                  </div>
                </div>
              </div>
            </div>

          </div>

        </div>

      </div>
    </div>

  </div>

  <!-- <h1>Experiment Home</h1>
  <p>Welcome to the Human AI Trust Experiment, an experience developed by <em>Kavya, Eric, and Jackson</em>!</p>
  <h2>Dynamic content</h2>
  <p>The database has the following record count: {{ num_responses }}</p>
    
    {% for response in user_responses %}
    <ul>
      <li>{{ response.field_data_point_string }}</li>
      <li>{{ response.field_ml_accuracy }}</li>
      <li>{{ response.field_ml_confidence }}</li>
      <li>{{ response.field_ml_prediction }}</li>
      <li>{{ response.field_user_prediction }}</li>
      <li>{{ response.field_user_did_update }}</li>
      <li>{{ response.field_user_disagree_reason_choices }}</li>
      <li>{{ response.field_user_disagree_reason_freetext }}</li>
    </ul>
    {% endfor %} -->
  
{% endblock %}